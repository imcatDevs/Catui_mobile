<div class="demo-page">
  <h1 class="demo-title">Form Components</h1>
  <p class="demo-subtitle">고급 폼 컴포넌트 - FileUpload, Rating, SignaturePad, FormWizard</p>

  <!-- FileUpload -->
  <section class="demo-section">
    <h2 class="demo-section-title">FileUpload</h2>
    
    <div class="card mb-4">
      <div class="card-header">기본 파일 업로드</div>
      <div class="card-body">
        <div id="file-upload-basic"></div>
        <div id="file-upload-result" class="mt-3 text-secondary text-sm"></div>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">이미지 전용 (다중 선택)</div>
      <div class="card-body">
        <div id="file-upload-images"></div>
      </div>
    </div>
  </section>

  <!-- Rating -->
  <section class="demo-section">
    <h2 class="demo-section-title">Rating</h2>
    
    <div class="card mb-4">
      <div class="card-header">기본 별점</div>
      <div class="card-body">
        <div class="demo-row">
          <span class="demo-label">평점:</span>
          <div id="rating-basic"></div>
        </div>
        <div id="rating-result" class="mt-3 text-secondary text-sm"></div>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">다양한 옵션</div>
      <div class="card-body">
        <div class="demo-row mb-3">
          <span class="demo-label">반 별점:</span>
          <div id="rating-half"></div>
        </div>
        <div class="demo-row mb-3">
          <span class="demo-label">읽기 전용:</span>
          <div id="rating-readonly"></div>
        </div>
        <div class="demo-row mb-3">
          <span class="demo-label">하트 아이콘:</span>
          <div id="rating-hearts"></div>
        </div>
        <div class="demo-row">
          <span class="demo-label">크기 비교:</span>
          <div class="d-flex align-items-center gap-3">
            <div id="rating-sm"></div>
            <div id="rating-md"></div>
            <div id="rating-lg"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SignaturePad -->
  <section class="demo-section">
    <h2 class="demo-section-title">SignaturePad</h2>
    
    <div class="card mb-4">
      <div class="card-header">서명 패드</div>
      <div class="card-body">
        <div id="signature-pad"></div>
        <div class="mt-3 d-flex gap-2">
          <button id="sig-save" class="btn btn-primary btn-sm">저장</button>
          <button id="sig-preview" class="btn btn-outline btn-sm">미리보기</button>
        </div>
        <div id="signature-preview" class="mt-3"></div>
      </div>
    </div>
  </section>

  <!-- FormWizard -->
  <section class="demo-section">
    <h2 class="demo-section-title">FormWizard</h2>
    
    <div class="card mb-4">
      <div class="card-header">단계별 폼</div>
      <div class="card-body">
        <div id="form-wizard"></div>
      </div>
    </div>
    
    <div id="wizard-result" class="card mb-4" style="display: none;">
      <div class="card-header">제출 결과</div>
      <div class="card-body">
        <pre id="wizard-result-data" class="text-sm"></pre>
      </div>
    </div>
  </section>
</div>

<style>
.demo-row {
  display: flex;
  align-items: center;
  gap: 12px;
}
.demo-label {
  min-width: 80px;
  font-size: 14px;
  color: var(--text-secondary);
}
.d-flex { display: flex; }
.align-items-center { align-items: center; }
.gap-2 { gap: 8px; }
.gap-3 { gap: 12px; }
.mb-3 { margin-bottom: 12px; }
.mb-4 { margin-bottom: 16px; }
.mt-3 { margin-top: 12px; }
.text-sm { font-size: 14px; }
.text-secondary { color: var(--text-secondary); }

/* Wizard 폼 스타일 */
.wizard-form-group {
  margin-bottom: 16px;
}
.wizard-form-group label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
}
.wizard-form-group input,
.wizard-form-group select,
.wizard-form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background: var(--bg-primary);
  color: var(--text-primary);
}
.wizard-form-group input:focus,
.wizard-form-group select:focus,
.wizard-form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}
.wizard-form-group .error-message {
  color: var(--error);
  font-size: 12px;
  margin-top: 4px;
}
.wizard-summary {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: 16px;
}
.wizard-summary-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--border-color);
}
.wizard-summary-item:last-child {
  border-bottom: none;
}
.wizard-summary-label {
  color: var(--text-secondary);
  font-size: 14px;
}
.wizard-summary-value {
  color: var(--text-primary);
  font-weight: 500;
}
</style>

<script type="module">
(async () => {
  const { FileUpload, Rating, SignaturePad, FormWizard } = await CATUI.use('forms');
  const { Toast } = await CATUI.use('overlays');

  // ============ FileUpload ============
  const fileUploadBasic = new FileUpload({
    container: '#file-upload-basic',
    accept: '.pdf,.doc,.docx,.txt',
    maxSize: 5 * 1024 * 1024,
    placeholder: '문서 파일을 업로드하세요',
    onChange: (files) => {
      const result = document.getElementById('file-upload-result');
      result.textContent = files.length > 0 
        ? `${files.length}개 파일 선택됨` 
        : '선택된 파일 없음';
    },
    onError: (errors) => {
      errors.forEach(e => Toast.error(e.message));
    }
  });

  const fileUploadImages = new FileUpload({
    container: '#file-upload-images',
    accept: 'image/*',
    multiple: true,
    maxFiles: 5,
    maxSize: 10 * 1024 * 1024,
    placeholder: '이미지를 업로드하세요 (최대 5개)',
    onChange: (files) => {
      console.log('이미지 파일:', files);
    },
    onError: (errors) => {
      errors.forEach(e => Toast.error(e.message));
    }
  });

  // ============ Rating ============
  const ratingBasic = new Rating({
    container: '#rating-basic',
    value: 3,
    showValue: true,
    onChange: (value) => {
      document.getElementById('rating-result').textContent = `선택한 평점: ${value}점`;
    }
  });

  const ratingHalf = new Rating({
    container: '#rating-half',
    value: 3.5,
    step: 0.5,
    showValue: true
  });

  const ratingReadonly = new Rating({
    container: '#rating-readonly',
    value: 4.5,
    step: 0.5,
    readonly: true,
    showValue: true
  });

  const ratingHearts = new Rating({
    container: '#rating-hearts',
    value: 3,
    icon: 'favorite',
    activeColor: 'var(--error, #EF4444)',
    showValue: true
  });

  const ratingSm = new Rating({
    container: '#rating-sm',
    value: 4,
    size: 'sm'
  });

  const ratingMd = new Rating({
    container: '#rating-md',
    value: 4,
    size: 'md'
  });

  const ratingLg = new Rating({
    container: '#rating-lg',
    value: 4,
    size: 'lg'
  });

  // ============ SignaturePad ============
  const signaturePad = new SignaturePad({
    container: '#signature-pad',
    width: 350,
    height: 150,
    lineColor: 'var(--text-primary)',
    onChange: (dataUrl) => {
      console.log('서명 변경:', dataUrl ? '데이터 있음' : '비어있음');
    }
  });

  document.getElementById('sig-save').addEventListener('click', () => {
    if (signaturePad.isEmpty()) {
      Toast.warning('서명을 입력해주세요');
      return;
    }
    const dataUrl = signaturePad.toDataURL();
    console.log('서명 데이터:', dataUrl);
    Toast.success('서명이 저장되었습니다');
  });

  document.getElementById('sig-preview').addEventListener('click', () => {
    const preview = document.getElementById('signature-preview');
    if (signaturePad.isEmpty()) {
      preview.innerHTML = '<p class="text-secondary">서명이 비어있습니다</p>';
      return;
    }
    preview.innerHTML = `<img src="${signaturePad.toDataURL()}" alt="서명 미리보기" style="max-width: 100%; border: 1px solid var(--border-color); border-radius: 8px;">`;
  });

  // ============ FormWizard ============
  const formWizard = new FormWizard({
    container: '#form-wizard',
    allowStepClick: true,
    steps: [
      {
        title: '기본 정보',
        content: `
          <div class="wizard-form-group">
            <label>이름 *</label>
            <input type="text" name="name" placeholder="이름을 입력하세요" required>
          </div>
          <div class="wizard-form-group">
            <label>이메일 *</label>
            <input type="email" name="email" placeholder="이메일을 입력하세요" required>
          </div>
          <div class="wizard-form-group">
            <label>전화번호</label>
            <input type="tel" name="phone" placeholder="010-0000-0000">
          </div>
        `,
        validate: (step, panel) => {
          const name = panel.querySelector('[name="name"]').value.trim();
          const email = panel.querySelector('[name="email"]').value.trim();
          
          if (!name) {
            Toast.error('이름을 입력해주세요');
            return false;
          }
          if (!email || !email.includes('@')) {
            Toast.error('올바른 이메일을 입력해주세요');
            return false;
          }
          return true;
        }
      },
      {
        title: '추가 정보',
        content: `
          <div class="wizard-form-group">
            <label>생년월일</label>
            <input type="date" name="birthdate">
          </div>
          <div class="wizard-form-group">
            <label>성별</label>
            <select name="gender">
              <option value="">선택하세요</option>
              <option value="male">남성</option>
              <option value="female">여성</option>
              <option value="other">기타</option>
            </select>
          </div>
          <div class="wizard-form-group">
            <label>자기소개</label>
            <textarea name="bio" rows="3" placeholder="간단한 자기소개를 작성해주세요"></textarea>
          </div>
        `
      },
      {
        title: '완료',
        content: `
          <div class="wizard-summary">
            <h3 style="margin: 0 0 16px 0; font-size: 16px;">입력 정보 확인</h3>
            <div class="wizard-summary-item">
              <span class="wizard-summary-label">이름</span>
              <span class="wizard-summary-value" id="summary-name">-</span>
            </div>
            <div class="wizard-summary-item">
              <span class="wizard-summary-label">이메일</span>
              <span class="wizard-summary-value" id="summary-email">-</span>
            </div>
            <div class="wizard-summary-item">
              <span class="wizard-summary-label">전화번호</span>
              <span class="wizard-summary-value" id="summary-phone">-</span>
            </div>
            <div class="wizard-summary-item">
              <span class="wizard-summary-label">생년월일</span>
              <span class="wizard-summary-value" id="summary-birthdate">-</span>
            </div>
            <div class="wizard-summary-item">
              <span class="wizard-summary-label">성별</span>
              <span class="wizard-summary-value" id="summary-gender">-</span>
            </div>
          </div>
          <p class="mt-3 text-sm text-secondary">위 내용이 맞으면 '완료' 버튼을 눌러주세요.</p>
        `
      }
    ],
    onStepChange: (step, direction) => {
      console.log(`Step changed to ${step} (${direction})`);
      
      // 마지막 단계에서 요약 업데이트
      if (step === 2) {
        const data = formWizard.getData();
        document.getElementById('summary-name').textContent = data.name || '-';
        document.getElementById('summary-email').textContent = data.email || '-';
        document.getElementById('summary-phone').textContent = data.phone || '-';
        document.getElementById('summary-birthdate').textContent = data.birthdate || '-';
        document.getElementById('summary-gender').textContent = 
          data.gender === 'male' ? '남성' : 
          data.gender === 'female' ? '여성' : 
          data.gender === 'other' ? '기타' : '-';
      }
    },
    onSubmit: (data) => {
      console.log('Form submitted:', data);
      Toast.success('폼이 제출되었습니다!');
      
      const resultEl = document.getElementById('wizard-result');
      const resultData = document.getElementById('wizard-result-data');
      resultEl.style.display = 'block';
      resultData.textContent = JSON.stringify(data, null, 2);
    }
  });

  // Cleanup
  window.addEventListener('beforeunload', () => {
    fileUploadBasic.destroy();
    fileUploadImages.destroy();
    ratingBasic.destroy();
    ratingHalf.destroy();
    ratingReadonly.destroy();
    ratingHearts.destroy();
    ratingSm.destroy();
    ratingMd.destroy();
    ratingLg.destroy();
    signaturePad.destroy();
    formWizard.destroy();
  });
})();
</script>
