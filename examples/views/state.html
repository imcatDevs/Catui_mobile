<div class="fade-in">
  <!-- 카운터 데모 -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">calculate</span>
      상태 관리 - 카운터
    </div>
    <div class="card-content">
      <code>CATUI.state.create()</code>로 반응형 상태를 생성하고, 
      <code>watch()</code>로 변경을 감지합니다.
    </div>
    <div class="counter-demo">
      <button class="counter-btn" id="dec-btn">−</button>
      <span class="counter-value" id="counter-value">0</span>
      <button class="counter-btn" id="inc-btn">+</button>
    </div>
    <div class="btn-group" style="justify-content: center;">
      <button class="btn btn-secondary" id="reset-btn">리셋</button>
    </div>
  </div>

  <!-- 이벤트 버스 데모 -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">hub</span>
      이벤트 버스
    </div>
    <div class="card-content">
      <code>CATUI.emit()</code>과 <code>CATUI.on()</code>으로 
      컴포넌트 간 통신이 가능합니다.
    </div>
    <div class="btn-group">
      <button class="btn btn-primary" id="emit-btn">
        <span class="material-icons" style="font-size: 18px; vertical-align: middle;">send</span>
        이벤트 발행
      </button>
    </div>
    <div class="output-log" id="event-log"></div>
  </div>

  <!-- DOM 조작 데모 -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">code</span>
      DOM 조작
    </div>
    <div class="card-content">
      <code>CATUI('#selector')</code>로 jQuery 스타일의 체이닝이 가능합니다.
    </div>
    <div class="btn-group">
      <button class="btn btn-outline" id="dom-add">addClass</button>
      <button class="btn btn-outline" id="dom-remove">removeClass</button>
      <button class="btn btn-outline" id="dom-toggle">toggleClass</button>
    </div>
    <div class="demo-box" id="dom-target">
      타겟
    </div>
  </div>

  <!-- 유틸리티 데모 -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">build</span>
      유틸리티
    </div>
    <ul class="list">
      <li class="list-item">
        <span class="material-icons item-icon">fingerprint</span>
        <div class="item-content">
          <div class="item-label">randomId()</div>
          <div class="item-value" id="random-id">-</div>
        </div>
        <button class="btn btn-secondary" id="gen-id" style="padding: 8px 16px; font-size: 12px;">생성</button>
      </li>
      <li class="list-item">
        <span class="material-icons item-icon">timer</span>
        <div class="item-content">
          <div class="item-label">debounce() 테스트</div>
          <div class="item-value" id="debounce-count">입력: 0, 실행: 0</div>
        </div>
      </li>
    </ul>
    <div class="form-group">
      <input type="text" class="form-input" id="debounce-input" placeholder="빠르게 입력해보세요...">
    </div>
  </div>
</div>

<script>
(function() {
  // ========================================
  // 상태 관리 - 카운터
  // ========================================
  const state = CATUI.state.create({ count: 0 });
  const counterValue = CATUI('#counter-value');
  
  // 상태 변경 감시
  state.watch('count', (newVal) => {
    counterValue.text(newVal).css({ transform: 'scale(1.2)' });
    setTimeout(() => counterValue.css({ transform: '' }), 150);
  });
  
  CATUI('#inc-btn').on('click', () => state.count++);
  CATUI('#dec-btn').on('click', () => state.count--);
  CATUI('#reset-btn').on('click', () => state.count = 0);

  // ========================================
  // 이벤트 버스
  // ========================================
  const eventLog = CATUI('#event-log');
  let eventCount = 0;
  
  function addEventLog(message) {
    const item = CATUI.create('div', {
      class: 'log-item log-success',
      text: `[${new Date().toLocaleTimeString()}] ${message}`
    });
    eventLog.prepend(item);
    
    // 최대 5개 유지
    const children = eventLog.find('.log-item');
    if (children.length > 5) {
      CATUI(children[children.length - 1]).remove();
    }
  }
  
  // 이벤트 구독
  const unsubscribe = CATUI.on('demo:event', (data) => {
    addEventLog(`이벤트 수신: ${data.message} (#${data.count})`);
  });
  
  CATUI('#emit-btn').on('click', () => {
    eventCount++;
    CATUI.emit('demo:event', { message: '안녕하세요!', count: eventCount });
  });

  // ========================================
  // DOM 조작
  // ========================================
  const domTarget = CATUI('#dom-target');
  
  CATUI('#dom-add').on('click', () => domTarget.addClass('touch-active'));
  CATUI('#dom-remove').on('click', () => domTarget.removeClass('touch-active'));
  CATUI('#dom-toggle').on('click', () => domTarget.toggleClass('touch-active'));

  // ========================================
  // 유틸리티
  // ========================================
  
  // Random ID
  CATUI('#gen-id').on('click', () => {
    CATUI('#random-id').text(CATUI.randomId('item'));
  });
  
  // Debounce
  let inputCount = 0;
  let execCount = 0;
  
  const debouncedFn = CATUI.debounce(() => {
    execCount++;
    CATUI('#debounce-count').text(`입력: ${inputCount}, 실행: ${execCount}`);
  }, 500);
  
  CATUI('#debounce-input').on('input', () => {
    inputCount++;
    CATUI('#debounce-count').text(`입력: ${inputCount}, 실행: ${execCount}`);
    debouncedFn();
  });

  // ========================================
  // 정리
  // ========================================
  if (CATUI.view && CATUI.view.registerInstance) {
    CATUI.view.registerInstance({
      destroy: () => {
        unsubscribe();
        state.destroy();
      }
    });
  }
})();
</script>
