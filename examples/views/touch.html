<div class="fade-in">
  <!-- íƒ­ & ë¡±í”„ë ˆìŠ¤ -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">ads_click</span>
      íƒ­ & ë¡±í”„ë ˆìŠ¤
    </div>
    <div class="demo-area" id="tap-area">
      íƒ­ ë˜ëŠ” ê¸¸ê²Œ ëˆ„ë¥´ì„¸ìš”
    </div>
    <div class="output-log" id="tap-log"></div>
  </div>

  <!-- ìŠ¤ì™€ì´í”„ -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">swipe</span>
      ìŠ¤ì™€ì´í”„
    </div>
    <div class="swipe-container">
      <div class="swipe-card" id="swipe-area">
        <span class="material-icons" style="font-size: 48px;">swipe</span>
        <div>ì¢Œ/ìš°ë¡œ ìŠ¤ì™€ì´í”„</div>
        <div class="swipe-hint" id="swipe-hint">â† ë˜ëŠ” â†’</div>
      </div>
    </div>
  </div>

  <!-- ë“œë˜ê·¸ -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">drag_indicator</span>
      ë“œë˜ê·¸
    </div>
    <div class="demo-area" style="height: 200px; position: relative;">
      <div class="demo-box" id="drag-box">
        ë“œë˜ê·¸
      </div>
    </div>
  </div>

  <!-- í•€ì¹˜ ì¤Œ -->
  <div class="card">
    <div class="card-title">
      <span class="material-icons">pinch</span>
      í•€ì¹˜ ì¤Œ
    </div>
    <div class="demo-area" id="pinch-area" style="height: 150px;">
      <div id="pinch-target" style="font-size: 48px; transition: transform 0.1s;">
        ğŸ±
      </div>
      <div id="pinch-info" style="margin-top: 10px;">ë‘ ì†ê°€ë½ìœ¼ë¡œ í™•ëŒ€/ì¶•ì†Œ</div>
    </div>
  </div>
</div>

<script>
(function() {
  // CATUI í™•ì¸
  if (typeof CATUI === 'undefined') {
    console.error('CATUI not loaded');
    return;
  }
  
  if (typeof CATUI.touch !== 'function') {
    console.error('CATUI.touch is not available');
    return;
  }
  
  // ========================================
  // íƒ­ & ë¡±í”„ë ˆìŠ¤
  // ========================================
  const tapArea = CATUI('#tap-area');
  const tapLog = CATUI('#tap-log');
  
  function addLog(logEl, message, type = '') {
    const item = CATUI.create('div', {
      class: 'log-item' + (type ? ' log-' + type : ''),
      text: `[${new Date().toLocaleTimeString()}] ${message}`
    });
    logEl.prepend(item);
    
    // ìµœëŒ€ 10ê°œ ìœ ì§€
    const children = logEl.find('.log-item');
    if (children.length > 10) {
      CATUI(children[children.length - 1]).remove();
    }
  }
  
  const tapTouch = CATUI.touch(tapArea.get(0));
  
  tapTouch.on('tap', (data) => {
    tapArea.addClass('touch-active');
    addLog(tapLog, `íƒ­! (${Math.round(data.x)}, ${Math.round(data.y)})`, 'success');
    setTimeout(() => tapArea.removeClass('touch-active'), 200);
  });
  
  tapTouch.on('doubletap', () => addLog(tapLog, 'ë”ë¸”íƒ­!', 'success'));
  
  tapTouch.on('longpress', () => {
    addLog(tapLog, 'ë¡±í”„ë ˆìŠ¤!', 'success');
    if (navigator.vibrate) navigator.vibrate(50);
  });

  // ========================================
  // ìŠ¤ì™€ì´í”„ (iOS ë’¤ë¡œê°€ê¸° ì œìŠ¤ì²˜ ë°©ì§€)
  // ========================================
  const swipeArea = CATUI('#swipe-area');
  const swipeHint = CATUI('#swipe-hint');
  
  // iOS edge swipe ë°©ì§€
  swipeArea.css({ touchAction: 'none', overscrollBehavior: 'none' });
  
  const swipeTouch = CATUI.touch(swipeArea.get(0), {
    swipeThreshold: 20,
    preventScroll: true
  });
  
  swipeTouch.on('swipeleft', () => {
    swipeArea.css({ transform: 'translateX(-20px)' });
    swipeHint.text('â† ì™¼ìª½ ìŠ¤ì™€ì´í”„!');
    setTimeout(() => {
      swipeArea.css({ transform: '' });
      swipeHint.text('â† ë˜ëŠ” â†’');
    }, 300);
  });
  
  swipeTouch.on('swiperight', () => {
    swipeArea.css({ transform: 'translateX(20px)' });
    swipeHint.text('ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„! â†’');
    setTimeout(() => {
      swipeArea.css({ transform: '' });
      swipeHint.text('â† ë˜ëŠ” â†’');
    }, 300);
  });
  
  swipeTouch.on('swipeup', () => {
    swipeHint.text('â†‘ ìœ„ë¡œ ìŠ¤ì™€ì´í”„!');
    setTimeout(() => swipeHint.text('â† ë˜ëŠ” â†’'), 500);
  });
  
  swipeTouch.on('swipedown', () => {
    swipeHint.text('â†“ ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„!');
    setTimeout(() => swipeHint.text('â† ë˜ëŠ” â†’'), 500);
  });

  // ========================================
  // ë“œë˜ê·¸ (movementX/Y ì‚¬ìš©)
  // ========================================
  const dragBox = CATUI('#drag-box');
  let boxX = 0, boxY = 0;
  let isDragging = false;
  
  const dragTouch = CATUI.touch(dragBox.get(0), { preventScroll: true });
  
  function startDrag() {
    isDragging = true;
    dragBox.css({ transition: 'none', boxShadow: '0 10px 30px rgba(0,0,0,0.3)', cursor: 'grabbing' });
  }
  
  function endDrag() {
    if (!isDragging) return;
    isDragging = false;
    dragBox.css({ transition: 'transform 0.3s, box-shadow 0.3s', boxShadow: '', cursor: 'grab' });
  }
  
  dragBox.on('touchstart', startDrag).on('mousedown', startDrag);
  dragBox.on('touchend', endDrag).on('mouseup', endDrag);
  CATUI(document).on('mouseup', endDrag);
  
  dragTouch.on('pan', (data) => {
    if (!isDragging) return;
    boxX += data.movementX || 0;
    boxY += data.movementY || 0;
    
    const parent = dragBox.get(0).parentElement;
    const maxX = (parent.offsetWidth - dragBox.get(0).offsetWidth) / 2;
    const maxY = (parent.offsetHeight - dragBox.get(0).offsetHeight) / 2;
    
    boxX = Math.max(-maxX, Math.min(maxX, boxX));
    boxY = Math.max(-maxY, Math.min(maxY, boxY));
    
    dragBox.css({ transform: `translate(${boxX}px, ${boxY}px)` });
  });

  // ========================================
  // í•€ì¹˜ ì¤Œ
  // ========================================
  const pinchArea = CATUI('#pinch-area');
  const pinchTarget = CATUI('#pinch-target');
  const pinchInfo = CATUI('#pinch-info');
  let baseScale = 1;
  
  const pinchTouch = CATUI.touch(pinchArea.get(0), { preventScroll: true });
  
  pinchTouch.on('pinch', (data) => {
    const newScale = Math.max(0.5, Math.min(3, baseScale * data.scale));
    pinchTarget.css({ transform: `scale(${newScale})` });
    pinchInfo.text(`ìŠ¤ì¼€ì¼: ${newScale.toFixed(2)}`);
  });
  
  pinchArea.on('touchend', () => {
    const transform = pinchTarget.get(0).style.transform;
    const match = transform.match(/scale\(([\d.]+)\)/);
    if (match) baseScale = parseFloat(match[1]);
  });

  // ========================================
  // ì •ë¦¬
  // ========================================
  if (CATUI.view && CATUI.view.registerInstance) {
    CATUI.view.registerInstance({ destroy: () => {
      tapTouch.destroy();
      swipeTouch.destroy();
      dragTouch.destroy();
      pinchTouch.destroy();
    }});
  }
})();
</script>
